// 系统日志相关模型

/// API日志表 - 记录所有API请求的详细信息，用于监控和问题排查
model ApiLog {
  /// 日志ID - 主键，UUID格式
  id         String   @id @default(uuid())
  /// 请求ID - 唯一，用于追踪单次请求的完整生命周期
  requestId  String   @unique
  /// 用户ID - 发起请求的用户ID，未登录时为空
  userId     Int?
  /// 请求方法 - HTTP方法（GET、POST、PUT、DELETE等）
  method     String
  /// 请求URL - 完整的请求路径
  url        String   @db.Text
  /// 查询参数 - URL查询参数（JSON格式）
  params     Json?
  /// 请求体 - POST/PUT请求的请求体（JSON格式）
  body       Json?
  /// 响应数据 - 接口返回的响应内容（JSON格式）
  response   Json?
  /// 状态码 - HTTP状态码（200、404、500等）
  statusCode Int
  /// 响应时间 - 请求处理耗时（毫秒）
  duration   Int
  /// 客户端IP - 发起请求的IP地址
  ip         String
  /// 用户代理 - 客户端信息（浏览器、设备等）
  userAgent  String?  @db.Text
  /// 错误信息 - 请求失败时的错误详情
  error      String?  @db.Text
  /// 创建时间 - 日志记录时间
  createdAt  DateTime @default(now())

  // 关联关系
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([requestId])
  @@index([userId])
  @@index([createdAt])
  @@index([statusCode])
  @@map("api_logs")
}

/// 错误日志表 - 记录系统运行过程中的所有错误和异常
model ErrorLog {
  /// 日志ID - 主键，UUID格式
  id        String   @id @default(uuid())
  /// 请求ID - 关联到API日志的请求ID，用于错误追踪
  requestId String?
  /// 错误代码 - 业务错误码，用于分类和统计
  errorCode String
  /// 错误消息 - 错误的简要描述
  message   String   @db.Text
  /// 堆栈信息 - 完整的错误堆栈跟踪
  stack     String?  @db.Text
  /// 错误上下文 - 错误发生时的相关上下文信息（JSON格式）
  context   Json?
  /// 用户ID - 触发错误的用户ID
  userId    Int?
  /// 客户端IP - 发起请求的IP地址
  ip        String?
  /// 用户代理 - 客户端信息
  userAgent String?
  /// 创建时间 - 错误发生时间
  createdAt DateTime @default(now())

  @@index([requestId])
  @@index([errorCode])
  @@index([createdAt])
  @@map("error_logs")
}

/// 审计日志表 - 记录用户对重要数据的增删改操作，用于安全审计和合规性追踪
model AuditLog {
  /// 日志ID - 主键，UUID格式
  id         String   @id @default(uuid())
  /// 用户ID - 执行操作的用户ID
  userId     Int?
  /// 操作动作 - 操作类型（create、update、delete等）
  action     String
  /// 资源类型 - 被操作的资源类型（user、role、permission等）
  resource   String
  /// 资源ID - 被操作的具体资源的ID
  resourceId String?
  /// 操作前数据 - 修改或删除前的原始数据（JSON格式）
  oldData    Json?
  /// 操作后数据 - 创建或修改后的新数据（JSON格式）
  newData    Json?
  /// 客户端IP - 发起操作的IP地址
  ip         String?
  /// 用户代理 - 客户端信息
  userAgent  String?  @db.Text
  /// 创建时间 - 操作发生时间
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
  @@map("audit_logs")
}